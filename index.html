<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Karten-App</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html,body { height: 100%; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      height: 100vh;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      touch-action: pan-x; /* Nur horizontales Scrollen erlauben */
      /* Übergang für sanfte Farbwechsel */
      transition: background 650ms ease;
      /* Fallback-Farbe falls Gradient nicht gezeichnet wird */
      background: linear-gradient(135deg, hsl(240 60% 60%) 0%, hsl(280 60% 45%) 100%);
    }

    .card-container {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 24px;
    }

    .card {
      width: 90%;
      max-width: 600px;
      min-height: 300px;
      padding: 40px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      text-align: center;
      font-size: 1.8em;
      user-select: none;
      display: flex;
      flex-direction: column;
      justify-content: center;
      line-height: 1.4;
    }

    /* Unsichtbare Bereiche für Touch an den Rändern */
    .edge-touch {
      position: absolute;
      top: 0;
      height: 100%;
      width: 20%;
      z-index: 10;
    }
    .left-edge { left: 0; }
    .right-edge { right: 0; }
  </style>
</head>
<body>
  <div class="card-container">
    <!-- Unsichtbare Touch-Bereiche an den Rändern -->
    <div class="edge-touch left-edge" id="leftEdge"></div>
    <div class="edge-touch right-edge" id="rightEdge"></div>

    <div class="card" id="card">
      Lade Fragen…
    </div>
  </div>

  <script>
    let questions = [];
    let currentIndex = 0;

    // Farb-Logik: startHue zufällig, delta = wie stark sich die Farbe pro Wechsel ändert
    let hue = Math.floor(Math.random() * 360);
    const HUE_DELTA = 14; // Grad pro Wechsel (kleiner = subtiler)
    const SAT1 = 60, LIG1 = 60;   // erster Farbpunkt
    const SAT2 = 60, LIG2 = 45;   // zweiter Farbpunkt

    async function loadCSV() {
      try {
        const res = await fetch('cards.csv');
        const text = await res.text();
        parseCSV(text);
        shuffleQuestions();
        currentIndex = 0;
        showCard();
      } catch (err) {
        document.getElementById('card').innerText = "Fehler beim Laden der CSV.";
        console.error(err);
      }
    }

    function parseCSV(text) {
      // robustere Trennung: Zeilen, ggf. \r\n, und Entfernen leerer Zeilen
      const lines = text.split(/\r\n|\n|\r/).filter(l => l.trim() !== '');
      // Falls Kopfzeile vorhanden: erkenne "id" oder "frage"/"question"
      let start = 0;
      if (lines.length && /(^|\s|,)(id|frage|question)(\s|,|$)/i.test(lines[0])) start = 1;
      questions = lines.slice(start).map(line => {
        // einfacher CSV-Split: trennt nur am ersten Komma, Rest bleibt Frage (falls Kommas in Text vorhanden)
        const idx = line.indexOf(',');
        if (idx === -1) return { id: '', question: line.trim() };
        const id = line.slice(0, idx).trim();
        const question = line.slice(idx + 1).trim();
        // Entferne mögliche umschließende Anführungszeichen
        const q = question.replace(/^"(.*)"$/, '$1').replace(/^'(.*)'$/, '$1');
        return { id, question: q };
      });
    }

    function shuffleQuestions() {
      for (let i = questions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [questions[i], questions[j]] = [questions[j], questions[i]];
      }
    }

    function changeBackground() {
      // hue wird erhöht, dann als Gradient gesetzt
      hue = (hue + HUE_DELTA) % 360;
      const h1 = hue;
      const h2 = (hue + 40) % 360;
      // Verwende CSS HSL-Syntax (neue Syntax ohne Kommas)
      document.body.style.background = `linear-gradient(135deg, hsl(${h1} ${SAT1}% ${LIG1}%) 0%, hsl(${h2} ${SAT2}% ${LIG2}%) 100%)`;
    }

    function showCard() {
      if (questions.length === 0) return;
      const q = questions[currentIndex];
      // Frage anzeigen (benutze innerHTML nicht nötig hier, setze TextContent)
      const cardEl = document.getElementById('card');
      cardEl.textContent = q.question;
      // Hintergrund leicht ändern
      changeBackground();
    }

    // Swipe-Funktionalität
    let startX = null;
    let startY = null;

    document.addEventListener("touchstart", e => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    }, { passive: true });

    document.addEventListener("touchmove", e => {
      if (startX === null || startY === null) return;
      const currentX = e.touches[0].clientX;
      const currentY = e.touches[0].clientY;
      const diffX = Math.abs(currentX - startX);
      const diffY = Math.abs(currentY - startY);
      // Wenn die Bewegung hauptsächlich vertikal ist, unterdrücken (keine horizontale Navigation)
      if (diffY > diffX) {
        e.preventDefault();
      }
    }, { passive: false });

    document.addEventListener("touchend", e => {
      if (startX === null) return;
      const endX = e.changedTouches[0].clientX;
      const diffX = endX - startX;
      if (Math.abs(diffX) > 50) {
        if (diffX > 0) {
          // nach rechts -> vorherige
          currentIndex = (currentIndex - 1 + questions.length) % questions.length;
        } else {
          // nach links -> nächste
          currentIndex = (currentIndex + 1) % questions.length;
        }
        showCard();
      }
      startX = null;
      startY = null;
    }, { passive: true });

    // Touch an den Bildrändern für vorherige/nächste Frage
    document.getElementById('leftEdge').addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + questions.length) % questions.length;
      showCard();
    });
    document.getElementById('rightEdge').addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % questions.length;
      showCard();
    });

    // Tastaturunterstützung
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        currentIndex = (currentIndex - 1 + questions.length) % questions.length;
        showCard();
      } else if (e.key === 'ArrowRight') {
        currentIndex = (currentIndex + 1) % questions.length;
        showCard();
      }
    });

    // Scrollen komplett verhindern
    document.addEventListener('scroll', () => { window.scrollTo(0, 0); });

    window.addEventListener('load', () => {
      window.scrollTo(0, 0);
    });

    // Verhindern, dass die Seite zoomt (iOS Gesten)
    ['gesturestart','gesturechange','gestureend'].forEach(ev => {
      document.addEventListener(ev, (e) => e.preventDefault());
    });

    // Initial laden
    loadCSV();
  </script>
</body>
</html>
